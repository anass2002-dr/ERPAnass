<main id="main" class="main">
  <div class="pagetitle">
    <nav>
      <ol class="breadcrumb" id="list_nav">
        <li *ngFor="let breadcrumb of breadcrumbs" class="breadcrumb-item">
          <a [routerLink]="'/'+formatBreadcrumbLink(breadcrumb,breadcrumbs)">{{ formatBreadcrumb(breadcrumb) }}</a>
        </li>
      </ol>
    </nav>
  </div>
  <div class="main_form">
    <div class="row">
      <div class="col-12">

        <section class="section">
          <div class="card">
            <div class="card-body">
              <h2 class="card-title text-center">{{ isUpdateMode ? 'Update' : 'Add' }} Movement</h2>
              <form [formGroup]="movementForm" (ngSubmit)="onSubmit()" class="row g-3">

                <!-- Article Selection -->
                <div class="col-6">
                  <label for="articleID" class="form-label">Article</label>
                  <ng-select [items]="articles" bindLabel="articleName" bindValue="idArticle" formControlName="articleID" id="articleID" placeholder="Select Article">
                  </ng-select>
                  <div *ngIf="movementForm.get('articleID')?.invalid && (movementForm.get('articleID')?.touched || showAlert)">
                    <small class="text-danger" *ngIf="movementForm.get('articleID')?.errors?.['required']">
                      Article is required.
                    </small>
                  </div>
                </div>

                <!-- Warehouse Selection -->
                <div class="col-6">
                  <label for="warehouseID" class="form-label">Warehouse</label>
                  <ng-select [items]="warehouses" bindLabel="name" bindValue="idWarehouse" formControlName="warehouseID" id="warehouseID" placeholder="Select Warehouse">
                  </ng-select>
                  <div *ngIf="movementForm.get('warehouseID')?.invalid && (movementForm.get('warehouseID')?.touched || showAlert)">
                    <small class="text-danger" *ngIf="movementForm.get('warehouseID')?.errors?.['required']">
                      Warehouse is required.
                    </small>
                  </div>
                </div>

                <!-- Quantity -->
                <div class="col-6">
                  <label for="quantity" class="form-label">Quantity</label>
                  <input type="number" id="quantity" formControlName="quantity" class="form-control">
                  <div *ngIf="movementForm.get('quantity')?.invalid && (movementForm.get('quantity')?.touched || showAlert)">
                    <small class="text-danger" *ngIf="movementForm.get('quantity')?.errors?.['required']">
                      Quantity is required.
                    </small>
                    <small class="text-danger" *ngIf="movementForm.get('quantity')?.errors?.['min']">
                      Quantity must be at least 1.
                    </small>
                  </div>
                </div>

                <!-- Movement Type -->
                <div class="col-6">
                  <label for="type" class="form-label">Movement Type</label>
                  <ng-select [items]="movementTypes" bindLabel="name" bindValue="id" formControlName="type" id="type" placeholder="Select Type">
                  </ng-select>
                  <div *ngIf="movementForm.get('type')?.invalid && (movementForm.get('type')?.touched || showAlert)">
                    <small class="text-danger" *ngIf="movementForm.get('type')?.errors?.['required']">
                      Movement Type is required.
                    </small>
                  </div>
                </div>

                <!-- Movement Date -->
                <div class="col-6">
                  <label for="movementDate" class="form-label">Date</label>
                  <input type="datetime-local" id="movementDate" formControlName="movementDate" class="form-control">
                  <div *ngIf="movementForm.get('movementDate')?.invalid && (movementForm.get('movementDate')?.touched || showAlert)">
                    <small class="text-danger" *ngIf="movementForm.get('movementDate')?.errors?.['required']">
                      Date is required.
                    </small>
                  </div>
                </div>

                <div class="text-center mt-4">
                  <button type="submit" class="btn btn-primary m-2">{{ isUpdateMode ? 'Update' : 'Save' }}</button>
                  <button type="button" class="btn btn-secondary m-2" (click)="onReset()" *ngIf="!isUpdateMode">Reset</button>
                  <a routerLink="/Inventory/Mouvement/WarehousesMovement" class="btn btn-light m-2">Cancel</a>
                </div>
              </form>
            </div>
          </div>

          <div *ngIf="showAlert" class="alert alert-danger alert-dismissible fade show" role="alert">
            Please fill in all required fields correctly.
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"
              (click)="showAlert = false"></button>
          </div>
        </section>

      </div>
    </div>
  </div>
</main>